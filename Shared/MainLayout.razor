@inherits LayoutComponentBase
@inject IJSRuntime JSRuntime;
@using FitnessTracker.Data;
@using System.Text.Json;
@inject FitnessService SampleService;

@if (!isRendered)
{
	<div class="main-content-overlay">
		<div class="app-loading">
			<svg class="circular" height="40" width="40">
				<circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="6" stroke-miterlimit="10" />
			</svg>
		</div>
		<div class="app-caption">
			<h4 class="my-4">Fitness tracker initializing...</h4>
		</div>
	</div>
}
else
{
	@Body
}

@code{
	[Inject]
	protected IJSRuntime JsRuntime { get; set; }

	private bool isRendered { get; set; }

	protected override async Task OnAfterRenderAsync(bool firstRender)
	{
		await base.OnAfterRenderAsync(firstRender);
		if (firstRender)
		{

			isRendered = true;
			string clientDetails = await JSRuntime.InvokeAsync<string>("getClientDetails");
			if (!string.IsNullOrEmpty(clientDetails))
			{
				var clientProps = JsonSerializer.Deserialize<Dictionary<string, object>>(clientDetails);
				SampleService.IsDevice = Convert.ToBoolean(clientProps["isDevice"].ToString());
				SampleService.InnerWidth = Convert.ToDouble(clientProps["innerWidth"].ToString());
			}
			StateHasChanged();
		}
	}
}